-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.attendance_policies (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  work_hours_start time without time zone NOT NULL DEFAULT '09:00:00'::time without time zone,
  work_hours_end time without time zone NOT NULL DEFAULT '17:00:00'::time without time zone,
  break_duration_minutes integer DEFAULT 60,
  late_arrival_threshold_minutes integer DEFAULT 15,
  overtime_threshold_minutes integer DEFAULT 480,
  require_location_verification boolean DEFAULT true,
  allow_early_checkin_minutes integer DEFAULT 30,
  allow_late_checkout_minutes integer DEFAULT 60,
  is_default boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT attendance_policies_pkey PRIMARY KEY (id),
  CONSTRAINT fk_attendance_policies_created_by FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.attendance_records (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id uuid NOT NULL,
  date date NOT NULL,
  check_in_time timestamp with time zone,
  check_out_time timestamp with time zone,
  total_hours numeric NOT NULL DEFAULT 0,
  regular_hours numeric NOT NULL DEFAULT 0,
  overtime_hours numeric NOT NULL DEFAULT 0,
  break_time numeric NOT NULL DEFAULT 0,
  status text NOT NULL DEFAULT 'present'::text CHECK (status = ANY (ARRAY['present'::text, 'absent'::text, 'partial'::text, 'late'::text, 'early_leave'::text])),
  late_minutes integer NOT NULL DEFAULT 0,
  early_leave_minutes integer NOT NULL DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT attendance_records_pkey PRIMARY KEY (id),
  CONSTRAINT fk_attendance_records_employee FOREIGN KEY (employee_id) REFERENCES public.users(id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  action character varying NOT NULL,
  table_name character varying NOT NULL,
  record_id uuid,
  old_values jsonb,
  new_values jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.departments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL UNIQUE,
  description text,
  manager_id uuid,
  budget_code character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  is_active boolean DEFAULT true,
  employee_count integer DEFAULT 0,
  growth_rate numeric DEFAULT 0,
  budget_utilization numeric DEFAULT 0,
  CONSTRAINT departments_pkey PRIMARY KEY (id),
  CONSTRAINT fk_departments_manager FOREIGN KEY (manager_id) REFERENCES public.users(id)
);
CREATE TABLE public.email_verification_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  verification_token character varying NOT NULL,
  expires_at timestamp without time zone NOT NULL,
  is_used boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT email_verification_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT fk_email_verification_tokens_user FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.employees (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  employee_id text UNIQUE,
  full_name text NOT NULL,
  email text NOT NULL UNIQUE,
  phone_number text,
  date_of_birth date,
  address text,
  emergency_contact text,
  emergency_phone text,
  department_id uuid,
  position_id uuid,
  manager_id uuid,
  hire_date date NOT NULL,
  salary numeric,
  employment_status text NOT NULL DEFAULT 'active'::text CHECK (employment_status = ANY (ARRAY['active'::text, 'inactive'::text, 'on_leave'::text, 'terminated'::text])),
  profile_picture text,
  skills jsonb,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  created_by uuid,
  updated_by uuid,
  CONSTRAINT employees_pkey PRIMARY KEY (id),
  CONSTRAINT employees_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.employees(id),
  CONSTRAINT employees_position_id_fkey FOREIGN KEY (position_id) REFERENCES public.positions(id),
  CONSTRAINT employees_department_id_fkey FOREIGN KEY (department_id) REFERENCES public.departments(id),
  CONSTRAINT fk_employees_created_by FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT fk_employees_user FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT fk_employees_updated_by FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.job_postings (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  title character varying NOT NULL,
  description text NOT NULL,
  department_id uuid,
  position_id uuid,
  requirements text,
  salary_min numeric,
  salary_max numeric,
  employment_type character varying DEFAULT 'full_time'::character varying CHECK (employment_type::text = ANY (ARRAY['full_time'::character varying, 'part_time'::character varying, 'contract'::character varying, 'internship'::character varying]::text[])),
  location character varying,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'active'::character varying, 'paused'::character varying, 'closed'::character varying, 'cancelled'::character varying]::text[])),
  posted_date date,
  closing_date date,
  posted_by uuid,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT job_postings_pkey PRIMARY KEY (id),
  CONSTRAINT fk_job_postings_department FOREIGN KEY (department_id) REFERENCES public.departments(id),
  CONSTRAINT fk_job_postings_position FOREIGN KEY (position_id) REFERENCES public.positions(id),
  CONSTRAINT fk_job_postings_posted_by FOREIGN KEY (posted_by) REFERENCES public.users(id)
);
CREATE TABLE public.leave_balances (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  employee_id character varying NOT NULL,
  leave_type_id uuid NOT NULL,
  year integer NOT NULL,
  allocated_days integer DEFAULT 0 CHECK (allocated_days >= 0),
  used_days integer DEFAULT 0 CHECK (used_days >= 0),
  carried_forward integer DEFAULT 0,
  remaining_days integer DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  policy_year integer,
  pending_days numeric DEFAULT 0 CHECK (pending_days >= 0::numeric),
  carried_over_days numeric DEFAULT 0 CHECK (carried_over_days >= 0::numeric),
  last_accrual_date date,
  available_days numeric DEFAULT ((((allocated_days)::numeric + carried_over_days) - (used_days)::numeric) - pending_days),
  CONSTRAINT leave_balances_pkey PRIMARY KEY (id),
  CONSTRAINT fk_leave_balances_leave_type FOREIGN KEY (leave_type_id) REFERENCES public.leave_types(id),
  CONSTRAINT fk_leave_balances_employee FOREIGN KEY (employee_id) REFERENCES public.users(employee_id)
);
CREATE TABLE public.leave_requests (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  employee_id character varying NOT NULL,
  leave_type_id uuid NOT NULL,
  start_date date NOT NULL,
  end_date date NOT NULL,
  total_days integer NOT NULL,
  reason text,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'cancelled'::character varying]::text[])),
  approved_by uuid,
  approved_at timestamp without time zone,
  rejection_reason text,
  emergency_contact character varying,
  handover_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT leave_requests_pkey PRIMARY KEY (id),
  CONSTRAINT fk_leave_requests_employee FOREIGN KEY (employee_id) REFERENCES public.users(employee_id),
  CONSTRAINT fk_leave_requests_approved_by FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT fk_leave_requests_leave_type FOREIGN KEY (leave_type_id) REFERENCES public.leave_types(id)
);
CREATE TABLE public.leave_types (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  description text,
  max_days_per_year integer DEFAULT 30,
  carry_forward_allowed boolean DEFAULT false,
  requires_approval boolean DEFAULT true,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT leave_types_pkey PRIMARY KEY (id)
);
CREATE TABLE public.notification_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  template_id uuid,
  title character varying NOT NULL,
  body text NOT NULL,
  type character varying NOT NULL,
  payload jsonb NOT NULL,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  sent_at timestamp with time zone,
  clicked_at timestamp with time zone,
  dismissed_at timestamp with time zone,
  error_message text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT notification_logs_pkey PRIMARY KEY (id),
  CONSTRAINT notification_logs_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.notification_templates(id),
  CONSTRAINT notification_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.notification_subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  endpoint text NOT NULL,
  p256dh_key text NOT NULL,
  auth_key text NOT NULL,
  user_agent text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT notification_subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT notification_subscriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.notification_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  body text NOT NULL,
  type character varying NOT NULL,
  variables jsonb DEFAULT '[]'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT notification_templates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.office_locations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  address text NOT NULL,
  latitude numeric,
  longitude numeric,
  radius_meters integer DEFAULT 100,
  is_default boolean DEFAULT false,
  is_active boolean DEFAULT true,
  timezone character varying DEFAULT 'UTC'::character varying,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT office_locations_pkey PRIMARY KEY (id),
  CONSTRAINT fk_office_locations_created_by FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.password_reset_attempts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL,
  ip_address inet,
  attempted_at timestamp with time zone DEFAULT now(),
  success boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT password_reset_attempts_pkey PRIMARY KEY (id)
);
CREATE TABLE public.password_reset_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  reset_token character varying NOT NULL,
  expires_at timestamp without time zone NOT NULL,
  is_used boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  ip_address inet,
  CONSTRAINT password_reset_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT fk_password_reset_tokens_user FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.payroll_periods (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  start_date date NOT NULL,
  end_date date NOT NULL,
  pay_date date NOT NULL,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'processing'::character varying, 'approved'::character varying, 'paid'::character varying, 'cancelled'::character varying]::text[])),
  processed_by uuid,
  approved_by uuid,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT payroll_periods_pkey PRIMARY KEY (id),
  CONSTRAINT fk_payroll_periods_processed_by FOREIGN KEY (processed_by) REFERENCES public.users(id),
  CONSTRAINT fk_payroll_periods_approved_by FOREIGN KEY (approved_by) REFERENCES public.users(id)
);
CREATE TABLE public.payroll_records (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  employee_id character varying NOT NULL,
  payroll_period_id uuid NOT NULL,
  basic_salary numeric NOT NULL,
  overtime_hours numeric DEFAULT 0,
  overtime_rate numeric DEFAULT 0,
  overtime_pay numeric DEFAULT 0,
  allowances numeric DEFAULT 0,
  bonuses numeric DEFAULT 0,
  gross_pay numeric DEFAULT (((basic_salary + overtime_pay) + allowances) + bonuses),
  tax_deduction numeric DEFAULT 0,
  pension_deduction numeric DEFAULT 0,
  insurance_deduction numeric DEFAULT 0,
  other_deductions numeric DEFAULT 0,
  total_deductions numeric DEFAULT (((tax_deduction + pension_deduction) + insurance_deduction) + other_deductions),
  net_pay numeric DEFAULT (((((((basic_salary + overtime_pay) + allowances) + bonuses) - tax_deduction) - pension_deduction) - insurance_deduction) - other_deductions),
  payment_method character varying DEFAULT 'bank_transfer'::character varying,
  payment_status character varying DEFAULT 'pending'::character varying CHECK (payment_status::text = ANY (ARRAY['pending'::character varying, 'paid'::character varying, 'failed'::character varying, 'cancelled'::character varying]::text[])),
  payment_date timestamp without time zone,
  payment_reference character varying,
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT payroll_records_pkey PRIMARY KEY (id),
  CONSTRAINT fk_payroll_records_period FOREIGN KEY (payroll_period_id) REFERENCES public.payroll_periods(id),
  CONSTRAINT fk_payroll_records_employee FOREIGN KEY (employee_id) REFERENCES public.users(employee_id)
);
CREATE TABLE public.positions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  title character varying NOT NULL UNIQUE,
  description text,
  department_id uuid NOT NULL,
  salary_min numeric,
  salary_max numeric,
  level character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT positions_pkey PRIMARY KEY (id),
  CONSTRAINT fk_positions_department FOREIGN KEY (department_id) REFERENCES public.departments(id)
);
CREATE TABLE public.projects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  description text,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'completed'::character varying, 'on_hold'::character varying, 'cancelled'::character varying]::text[])),
  start_date date,
  end_date date,
  manager_id uuid,
  department_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT projects_pkey PRIMARY KEY (id),
  CONSTRAINT projects_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.users(id),
  CONSTRAINT projects_department_id_fkey FOREIGN KEY (department_id) REFERENCES public.departments(id)
);
CREATE TABLE public.task_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  task_id uuid NOT NULL,
  assigned_to uuid NOT NULL,
  assigned_by uuid NOT NULL,
  assigned_at timestamp with time zone DEFAULT now(),
  is_active boolean DEFAULT true,
  CONSTRAINT task_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT task_assignments_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT task_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(id),
  CONSTRAINT task_assignments_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id)
);
CREATE TABLE public.task_comments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  task_id uuid NOT NULL,
  user_id uuid NOT NULL,
  comment text NOT NULL,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone,
  CONSTRAINT task_comments_pkey PRIMARY KEY (id),
  CONSTRAINT fk_task_comments_user FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT fk_task_comments_task FOREIGN KEY (task_id) REFERENCES public.tasks(id)
);
CREATE TABLE public.tasks (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  title character varying NOT NULL,
  description text,
  assigned_to uuid NOT NULL,
  assigned_by uuid NOT NULL,
  priority character varying DEFAULT 'medium'::character varying CHECK (priority::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'urgent'::character varying]::text[])),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['todo'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'on_hold'::character varying, 'pending'::character varying]::text[])),
  due_date date,
  completed_at timestamp without time zone,
  completion_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  start_date timestamp with time zone,
  completed_date timestamp with time zone,
  estimated_hours numeric,
  actual_hours numeric,
  tags jsonb DEFAULT '[]'::jsonb,
  attachments jsonb DEFAULT '[]'::jsonb,
  dependencies jsonb DEFAULT '[]'::jsonb,
  project_id uuid,
  department_id uuid,
  created_by uuid,
  updated_by uuid,
  progress_notes text,
  parent_task_id uuid,
  CONSTRAINT tasks_pkey PRIMARY KEY (id),
  CONSTRAINT tasks_parent_task_id_fkey FOREIGN KEY (parent_task_id) REFERENCES public.tasks(id),
  CONSTRAINT fk_tasks_assigned_to FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT fk_tasks_assigned_by FOREIGN KEY (assigned_by) REFERENCES public.users(id),
  CONSTRAINT fk_tasks_project FOREIGN KEY (project_id) REFERENCES public.projects(id)
);
CREATE TABLE public.time_entries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id uuid NOT NULL,
  check_in_time timestamp with time zone NOT NULL,
  check_out_time timestamp with time zone,
  check_in_location jsonb,
  check_out_location jsonb,
  location_status text,
  total_hours numeric,
  status text NOT NULL DEFAULT 'checked_in'::text CHECK (status = ANY (ARRAY['checked_in'::text, 'checked_out'::text, 'late'::text, 'early'::text, 'break'::text])),
  notes text,
  device_info text,
  requires_manual_review boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT time_entries_pkey PRIMARY KEY (id),
  CONSTRAINT fk_time_entries_employee FOREIGN KEY (employee_id) REFERENCES public.users(id)
);
CREATE TABLE public.user_notification_preferences (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  task_assignments boolean DEFAULT true,
  task_status_changes boolean DEFAULT true,
  task_comments boolean DEFAULT true,
  due_date_reminders boolean DEFAULT true,
  bulk_assignments boolean DEFAULT true,
  priority_changes boolean DEFAULT true,
  email_notifications boolean DEFAULT true,
  push_notifications boolean DEFAULT true,
  reminder_frequency character varying DEFAULT 'immediate'::character varying CHECK (reminder_frequency::text = ANY (ARRAY['immediate'::character varying, 'hourly'::character varying, 'daily'::character varying]::text[])),
  quiet_hours jsonb DEFAULT '{"end": "08:00", "start": "22:00", "enabled": false}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_notification_preferences_pkey PRIMARY KEY (id),
  CONSTRAINT user_notification_preferences_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.user_roles (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid NOT NULL,
  role_name character varying NOT NULL CHECK (role_name::text = ANY (ARRAY['super-admin'::character varying, 'hr-admin'::character varying, 'manager'::character varying, 'hr-staff'::character varying, 'employee'::character varying]::text[])),
  permissions jsonb DEFAULT '[]'::jsonb,
  assigned_by uuid,
  assigned_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT user_roles_pkey PRIMARY KEY (id),
  CONSTRAINT fk_user_roles_user FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT fk_user_roles_assigned_by FOREIGN KEY (assigned_by) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  email character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  password_hash character varying NOT NULL,
  google_id character varying UNIQUE,
  employee_id character varying NOT NULL UNIQUE,
  department_id uuid,
  position_id uuid,
  manager_id uuid,
  phone character varying,
  hire_date date NOT NULL,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'terminated'::character varying]::text[])),
  account_status character varying DEFAULT 'pending_setup'::character varying CHECK (account_status::text = ANY (ARRAY['pending_setup'::character varying, 'active'::character varying, 'suspended'::character varying]::text[])),
  is_temporary_password boolean DEFAULT false,
  last_password_change timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  invitation_sent_at timestamp without time zone,
  profile_data jsonb DEFAULT '{}'::jsonb,
  created_by uuid,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  email_verified boolean DEFAULT false,
  email_verified_at timestamp without time zone,
  date_of_birth date,
  address text,
  emergency_contact character varying,
  emergency_phone character varying,
  profile_picture character varying,
  role_level integer DEFAULT 1,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT fk_users_department FOREIGN KEY (department_id) REFERENCES public.departments(id),
  CONSTRAINT fk_users_position FOREIGN KEY (position_id) REFERENCES public.positions(id),
  CONSTRAINT fk_users_manager FOREIGN KEY (manager_id) REFERENCES public.users(id),
  CONSTRAINT fk_users_created_by FOREIGN KEY (created_by) REFERENCES public.users(id)
);